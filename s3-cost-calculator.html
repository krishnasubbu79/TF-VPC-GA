<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AWS S3 Batch Migration Cost Calculator</title>
  <style>
    :root {
      --aws-navy: #232f3e;
      --aws-orange: #ff9900;
      --aws-blue: #146eb4;
      --aws-light-blue: #1a8fe3;
      --bg: #f0f2f5;
      --card-bg: #ffffff;
      --border: #dde1e7;
      --text: #16191f;
      --text-muted: #5a6477;
      --green: #1ea97c;
      --red: #d13212;
      --shadow: 0 2px 10px rgba(0,0,0,0.08);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Amazon Ember', 'Segoe UI', system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
    }

    /* ===== HEADER ===== */
    header {
      background: var(--aws-navy);
      color: white;
      padding: 0 2rem;
      height: 60px;
      display: flex;
      align-items: center;
      gap: 1rem;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }
    .header-logo {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--aws-orange);
      letter-spacing: -0.5px;
    }
    .header-sep { width: 1px; height: 28px; background: rgba(255,255,255,0.2); }
    .header-title { font-size: 0.95rem; font-weight: 500; color: rgba(255,255,255,0.9); }
    .header-sub { font-size: 0.72rem; color: rgba(255,255,255,0.5); margin-top: 1px; }

    /* ===== WORKFLOW BANNER ===== */
    .workflow-banner {
      background: linear-gradient(135deg, #1a3a5c 0%, #232f3e 100%);
      color: white;
      padding: 1.2rem 2rem;
    }
    .workflow-steps {
      display: flex;
      align-items: center;
      gap: 0;
      max-width: 900px;
      margin: 0.5rem auto 0;
    }
    .wf-step {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      background: rgba(255,255,255,0.08);
      border-radius: 8px;
      padding: 0.6rem 1rem;
      flex: 1;
    }
    .wf-num {
      width: 24px; height: 24px;
      background: var(--aws-orange);
      color: white;
      border-radius: 50%;
      font-size: 0.78rem;
      font-weight: 700;
      display: flex; align-items: center; justify-content: center;
      flex-shrink: 0;
    }
    .wf-label { font-size: 0.78rem; font-weight: 500; line-height: 1.3; }
    .wf-arrow {
      color: var(--aws-orange);
      font-size: 1.2rem;
      padding: 0 0.4rem;
      flex-shrink: 0;
    }
    .workflow-title {
      font-size: 0.8rem;
      color: rgba(255,255,255,0.6);
      text-transform: uppercase;
      letter-spacing: 0.06em;
      font-weight: 600;
    }

    /* ===== LAYOUT ===== */
    .container { max-width: 1280px; margin: 0 auto; padding: 1.5rem 2rem 3rem; }

    .main-grid { display: grid; grid-template-columns: 360px 1fr; gap: 1.5rem; align-items: start; }

    /* ===== CARDS ===== */
    .card {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: var(--shadow);
      margin-bottom: 1rem;
    }
    .card-header {
      padding: 0.9rem 1.2rem;
      font-size: 0.88rem;
      font-weight: 700;
      color: var(--aws-navy);
      border-bottom: 1px solid var(--border);
      background: #fafbfc;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .card-body { padding: 1.2rem; }

    /* ===== FORM ELEMENTS ===== */
    .form-group { margin-bottom: 0.9rem; }
    .form-group:last-child { margin-bottom: 0; }

    label {
      display: block;
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--text-muted);
      margin-bottom: 0.3rem;
      text-transform: uppercase;
      letter-spacing: 0.03em;
    }

    input[type="number"], select {
      width: 100%;
      padding: 0.55rem 0.8rem;
      border: 1.5px solid var(--border);
      border-radius: 7px;
      font-size: 0.92rem;
      color: var(--text);
      background: white;
      transition: all 0.18s;
      appearance: auto;
    }
    input[type="number"]:focus, select:focus {
      outline: none;
      border-color: var(--aws-blue);
      box-shadow: 0 0 0 3px rgba(20,110,180,0.12);
    }
    .input-group {
      display: flex;
      align-items: center;
      border: 1.5px solid var(--border);
      border-radius: 7px;
      overflow: hidden;
      transition: all 0.18s;
    }
    .input-group:focus-within {
      border-color: var(--aws-blue);
      box-shadow: 0 0 0 3px rgba(20,110,180,0.12);
    }
    .input-group input {
      border: none;
      border-radius: 0;
      flex: 1;
      box-shadow: none !important;
    }
    .input-group input:focus { box-shadow: none !important; }
    .input-suffix {
      padding: 0.55rem 0.7rem;
      background: #f0f2f5;
      border-left: 1px solid var(--border);
      font-size: 0.78rem;
      font-weight: 600;
      color: var(--text-muted);
      white-space: nowrap;
    }

    .hint {
      font-size: 0.73rem;
      color: var(--text-muted);
      margin-top: 0.25rem;
      line-height: 1.4;
    }

    /* ===== SUMMARY CARDS ===== */
    .summary-bar {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    .summary-card {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1.2rem 1.4rem;
      box-shadow: var(--shadow);
      position: relative;
      overflow: hidden;
      transition: transform 0.2s;
    }
    .summary-card::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 3px;
    }
    .summary-card.s1::before { background: var(--green); }
    .summary-card.s2::before { background: var(--aws-blue); }
    .summary-card.s3::before { background: var(--aws-orange); }

    .summary-card .sc-label {
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      color: var(--text-muted);
      margin-bottom: 0.3rem;
    }
    .summary-card .sc-scenario {
      font-size: 0.82rem;
      font-weight: 500;
      color: var(--text);
      margin-bottom: 0.7rem;
    }
    .summary-card .sc-amount {
      font-size: 2.1rem;
      font-weight: 800;
      line-height: 1;
      margin-bottom: 0.2rem;
    }
    .s1 .sc-amount { color: var(--green); }
    .s2 .sc-amount { color: var(--aws-blue); }
    .s3 .sc-amount { color: var(--aws-orange); }
    .summary-card .sc-note {
      font-size: 0.72rem;
      color: var(--text-muted);
    }

    .cheapest-badge {
      display: inline-block;
      background: #e8f8f1;
      color: var(--green);
      font-size: 0.68rem;
      font-weight: 700;
      padding: 0.15rem 0.5rem;
      border-radius: 99px;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      margin-left: 0.4rem;
    }

    /* ===== TABS ===== */
    .tabs-container { background: var(--card-bg); border: 1px solid var(--border); border-radius: 12px; box-shadow: var(--shadow); overflow: hidden; }
    .tabs-nav {
      display: flex;
      border-bottom: 1px solid var(--border);
      background: #fafbfc;
      overflow-x: auto;
    }
    .tab-btn {
      padding: 0.85rem 1.2rem;
      border: none;
      background: none;
      cursor: pointer;
      font-size: 0.84rem;
      font-weight: 600;
      color: var(--text-muted);
      border-bottom: 3px solid transparent;
      white-space: nowrap;
      transition: all 0.2s;
    }
    .tab-btn.active { color: var(--aws-blue); border-bottom-color: var(--aws-blue); background: white; }
    .tab-btn:hover:not(.active) { color: var(--text); background: rgba(0,0,0,0.02); }

    .tab-panel { display: none; padding: 1.4rem; }
    .tab-panel.active { display: block; }

    /* ===== BREAKDOWN TABLE ===== */
    .breakdown-desc {
      font-size: 0.82rem;
      color: var(--text-muted);
      background: #f8f9fa;
      border-left: 3px solid var(--aws-blue);
      padding: 0.7rem 1rem;
      border-radius: 4px;
      margin-bottom: 1.2rem;
      line-height: 1.5;
    }

    .breakdown-table {
      width: 100%;
      border-collapse: collapse;
    }
    .breakdown-table thead th {
      background: #f0f2f5;
      padding: 0.65rem 1rem;
      text-align: left;
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-muted);
    }
    .breakdown-table thead th:last-child { text-align: right; }
    .breakdown-table tbody td {
      padding: 0.75rem 1rem;
      border-bottom: 1px solid #f0f2f5;
      font-size: 0.88rem;
      vertical-align: top;
    }
    .breakdown-table tbody tr:hover { background: #fafbfc; }
    .breakdown-table .cost-name { font-weight: 600; color: var(--text); }
    .breakdown-table .cost-detail { font-size: 0.78rem; color: var(--text-muted); margin-top: 0.15rem; }
    .breakdown-table .cost-amt { text-align: right; font-weight: 700; font-family: 'Courier New', monospace; font-size: 0.9rem; white-space: nowrap; }
    .cost-free { color: var(--green); }
    .cost-pos { color: var(--text); }
    .breakdown-table tfoot td {
      padding: 0.9rem 1rem;
      font-weight: 800;
      font-size: 1rem;
      border-top: 2px solid var(--aws-orange);
      background: #fffbf0;
    }
    .breakdown-table tfoot td:last-child { text-align: right; color: var(--aws-orange); }

    /* ===== COMPARISON VIEW ===== */
    .compare-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; }
    .compare-col { border: 1px solid var(--border); border-radius: 10px; overflow: hidden; }
    .compare-col-header {
      padding: 0.9rem 1rem;
      font-weight: 700;
      font-size: 0.82rem;
      text-align: center;
    }
    .compare-col-header.s1h { background: #e8f8f1; color: #147a5a; }
    .compare-col-header.s2h { background: #e8f4fd; color: var(--aws-blue); }
    .compare-col-header.s3h { background: #fff8e6; color: #9a6000; }
    .compare-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.55rem 1rem;
      border-bottom: 1px solid #f0f2f5;
      font-size: 0.8rem;
    }
    .compare-item-label { color: var(--text-muted); max-width: 65%; }
    .compare-item-val { font-weight: 700; font-family: monospace; font-size: 0.82rem; }
    .compare-total {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.8rem 1rem;
      font-weight: 800;
      font-size: 0.95rem;
      background: #f8f9fa;
      border-top: 2px solid var(--border);
    }
    .compare-total .s1-total { color: var(--green); }
    .compare-total .s2-total { color: var(--aws-blue); }
    .compare-total .s3-total { color: var(--aws-orange); }

    /* ===== TRANSFER RATE DISPLAY ===== */
    .rate-display {
      background: #f0f7ff;
      border: 1px solid #b8d9f5;
      border-radius: 8px;
      padding: 0.7rem 1rem;
      margin-top: 0.7rem;
      font-size: 0.8rem;
      color: var(--aws-blue);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .rate-display strong { font-size: 1rem; }

    /* ===== PRICING REF ===== */
    .pricing-ref {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.5rem 1.5rem;
      font-size: 0.78rem;
      line-height: 1.7;
      color: var(--text-muted);
    }
    .pricing-ref span { color: var(--text); font-weight: 600; }

    /* ===== SECTION LABEL ===== */
    .section-label {
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--text-muted);
      margin: 1.2rem 0 0.6rem;
      padding-bottom: 0.3rem;
      border-bottom: 1px solid var(--border);
    }
    .section-label:first-child { margin-top: 0; }

    /* ===== MISC ===== */
    .divider { height: 1px; background: var(--border); margin: 1rem 0; }

    @media (max-width: 900px) {
      .main-grid { grid-template-columns: 1fr; }
      .summary-bar { grid-template-columns: 1fr; }
      .compare-grid { grid-template-columns: 1fr; }
      header { padding: 0 1rem; }
      .container { padding: 1rem; }
    }
  </style>
</head>
<body>

<!-- Header -->
<header>
  <span class="header-logo">AWS</span>
  <div class="header-sep"></div>
  <div>
    <div class="header-title">S3 Batch Migration Cost Calculator</div>
    <div class="header-sub">Cross-Account ¬∑ Cross-Region ¬∑ S3 Batch Operations</div>
  </div>
</header>

<!-- Workflow Banner -->
<div class="workflow-banner">
  <div class="workflow-title">Workflow</div>
  <div class="workflow-steps">
    <div class="wf-step">
      <div class="wf-num">1</div>
      <div class="wf-label">Generate Manifest<br><span style="opacity:0.6;font-size:0.7rem">LIST API or S3 Inventory</span></div>
    </div>
    <div class="wf-arrow">‚Üí</div>
    <div class="wf-step">
      <div class="wf-num">2</div>
      <div class="wf-label">Create Batch Job<br><span style="opacity:0.6;font-size:0.7rem">Upload manifest to S3</span></div>
    </div>
    <div class="wf-arrow">‚Üí</div>
    <div class="wf-step">
      <div class="wf-num">3</div>
      <div class="wf-label">Run Copy Operation<br><span style="opacity:0.6;font-size:0.7rem">S3:PutObject / COPY</span></div>
    </div>
    <div class="wf-arrow">‚Üí</div>
    <div class="wf-step">
      <div class="wf-num">4</div>
      <div class="wf-label">Verify &amp; Complete<br><span style="opacity:0.6;font-size:0.7rem">Completion report</span></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="main-grid">

    <!-- LEFT: INPUTS -->
    <div>

      <!-- Workload Parameters -->
      <div class="card">
        <div class="card-header">üì¶ Workload Parameters</div>
        <div class="card-body">
          <div class="form-group">
            <label>Number of Objects to Transfer</label>
            <div class="input-group">
              <input type="number" id="numObjects" value="1000000" min="1" step="1000" />
              <span class="input-suffix">objects</span>
            </div>
            <div class="hint" id="objFormatHint">= 1,000,000 objects</div>
          </div>
          <div class="form-group">
            <label>Total Data Size</label>
            <div class="input-group">
              <input type="number" id="totalGB" value="1000" min="0.001" step="1" />
              <span class="input-suffix">GB</span>
            </div>
            <div class="hint" id="gbFormatHint">= 1,000 GB (~0.98 TiB)</div>
          </div>
          <div class="form-group">
            <label>Average Object Size</label>
            <div id="avgSizeDisplay" class="hint" style="padding: 0.4rem 0; font-size: 0.82rem; color: var(--text);">1.00 MB per object</div>
          </div>
          <div class="form-group">
            <label>Number of Batch Jobs</label>
            <div class="input-group">
              <input type="number" id="numJobs" value="1" min="1" step="1" />
              <span class="input-suffix">jobs</span>
            </div>
            <div class="hint">Each job creation costs $0.25</div>
          </div>
        </div>
      </div>

      <!-- Manifest Generation -->
      <div class="card">
        <div class="card-header">üìã Manifest Generation</div>
        <div class="card-body">
          <div class="form-group">
            <label>How will you generate the manifest?</label>
            <select id="manifestMethod">
              <option value="list">S3 ListObjectsV2 (List API)</option>
              <option value="inventory">S3 Inventory</option>
              <option value="provided">Pre-existing Manifest</option>
            </select>
          </div>
          <div id="manifestDetail" class="hint" style="margin-top: 0.4rem; line-height: 1.5;"></div>
          <div id="manifestCostLine" style="margin-top: 0.6rem; font-size: 0.82rem; font-weight: 600; color: var(--aws-blue);"></div>
        </div>
      </div>

      <!-- KMS Encryption -->
      <div class="card">
        <div class="card-header">üîê KMS Encryption</div>
        <div class="card-body">
          <div class="form-group">
            <label>Encryption Type</label>
            <select id="kmsType">
              <option value="cmk">Customer Managed Key (CMK) ‚Äî Both Buckets</option>
              <option value="aws">AWS Managed Key (aws/s3) ‚Äî Both Buckets</option>
              <option value="sse-s3">SSE-S3 (AES-256) ‚Äî No KMS cost</option>
            </select>
          </div>
          <div id="kmsInfo" class="hint" style="margin-top:0.5rem;line-height:1.6;"></div>
          <div id="kmsCostLine" style="margin-top:0.5rem;font-size:0.82rem;font-weight:600;color:var(--aws-blue);"></div>
          <div id="kmsWarning" style="display:none;margin-top:0.7rem;background:#fff8e6;border-left:3px solid #ff9900;border-radius:4px;padding:0.6rem 0.9rem;font-size:0.78rem;color:#7a4f00;line-height:1.6;"></div>
        </div>
      </div>

      <!-- Region Settings -->
      <div class="card">
        <div class="card-header">üåê Region Configuration</div>
        <div class="card-body">
          <div class="form-group">
            <label>Source Region</label>
            <select id="sourceRegion">
              <option value="us-east-1">US East (N. Virginia)</option>
              <option value="eu-west-1">EU (Ireland)</option>
              <option value="eu-west-2">EU (London)</option>
              <option value="ap-southeast-1">Asia Pacific (Singapore)</option>
              <option value="ap-east-1">Asia Pacific (Hong Kong)</option>
              <option value="ap-south-1">Asia Pacific (Mumbai)</option>
              <option value="ap-south-2">Asia Pacific (Hyderabad)</option>
              <option value="ap-southeast-3">Asia Pacific (Jakarta)</option>
            </select>
          </div>
          <div class="form-group">
            <label>Destination Region <span style="font-size:0.7rem;color:var(--text-muted);text-transform:none;letter-spacing:0">(for cross-region scenario)</span></label>
            <select id="destRegion">
              <option value="eu-west-1">EU (Ireland)</option>
              <option value="us-east-1">US East (N. Virginia)</option>
              <option value="eu-west-2">EU (London)</option>
              <option value="ap-southeast-1">Asia Pacific (Singapore)</option>
              <option value="ap-east-1">Asia Pacific (Hong Kong)</option>
              <option value="ap-south-1">Asia Pacific (Mumbai)</option>
              <option value="ap-south-2">Asia Pacific (Hyderabad)</option>
              <option value="ap-southeast-3">Asia Pacific (Jakarta)</option>
            </select>
          </div>
          <div class="rate-display" id="transferRateDisplay">
            <span>Cross-region data transfer rate</span>
            <strong id="transferRateVal">$0.020/GB</strong>
          </div>
        </div>
      </div>

      <!-- Pricing Reference -->
      <div class="card">
        <div class="card-header">üìå AWS Pricing Reference</div>
        <div class="card-body">
          <div class="pricing-ref">
            <div><span>Batch Job</span><br>$0.25 per job</div>
            <div><span>Batch Per Object</span><br>$1.00 per million objects</div>
            <div><span>PUT/COPY</span><br>$0.005 per 1,000 requests</div>
            <div><span>GET Requests</span><br>$0.0004 per 1,000 requests</div>
            <div><span>LIST Requests</span><br>$0.005 per 1,000 requests</div>
            <div><span>S3 Inventory</span><br>$0.0025 per million objects</div>
            <div><span>Same-Region Transfer</span><br>FREE (even cross-account)</div>
            <div><span>Cross-Region Transfer</span><br>Varies by region pair</div>
            <div><span>KMS API Calls</span><br>$0.03 per 10,000 requests</div>
            <div><span>KMS Key (CMK)</span><br>$1.00/month per key (ongoing)</div>
          </div>
          <div style="margin-top:0.8rem;font-size:0.72rem;color:var(--text-muted);border-top:1px solid var(--border);padding-top:0.6rem;">
            Based on us-east-1 standard pricing (2024). Prices vary by region. Verify at
            <a href="https://aws.amazon.com/s3/pricing/" style="color:var(--aws-blue);" target="_blank">aws.amazon.com/s3/pricing</a>
          </div>
        </div>
      </div>
    </div>

    <!-- RIGHT: RESULTS -->
    <div>

      <!-- Summary Bar -->
      <div class="summary-bar">
        <div class="summary-card s1">
          <div class="sc-label">Scenario 1</div>
          <div class="sc-scenario">Same Account ¬∑ Same Region</div>
          <div class="sc-amount" id="total-s1">$0.00</div>
          <div class="sc-note" id="note-s1">‚Äî</div>
        </div>
        <div class="summary-card s2">
          <div class="sc-label">Scenario 2</div>
          <div class="sc-scenario">Cross Account ¬∑ Same Region</div>
          <div class="sc-amount" id="total-s2">$0.00</div>
          <div class="sc-note" id="note-s2">‚Äî</div>
        </div>
        <div class="summary-card s3">
          <div class="sc-label">Scenario 3</div>
          <div class="sc-scenario">Cross Account ¬∑ Cross Region</div>
          <div class="sc-amount" id="total-s3">$0.00</div>
          <div class="sc-note" id="note-s3">‚Äî</div>
        </div>
      </div>

      <!-- Detailed Tabs -->
      <div class="tabs-container">
        <div class="tabs-nav">
          <button class="tab-btn active" onclick="switchTab('s1', this)">Same Acct ¬∑ Same Region</button>
          <button class="tab-btn" onclick="switchTab('s2', this)">Cross Acct ¬∑ Same Region</button>
          <button class="tab-btn" onclick="switchTab('s3', this)">Cross Acct ¬∑ Cross Region</button>
          <button class="tab-btn" onclick="switchTab('compare', this)">‚öñ Compare All</button>
        </div>

        <!-- PANEL S1 -->
        <div id="panel-s1" class="tab-panel active">
          <div class="breakdown-desc">
            <strong>Scenario:</strong> Moving data between S3 buckets within the <strong>same AWS account and same region</strong> using S3 Batch Operations.
            Data transfer between buckets in the same region is always free. You pay only for the Batch Operations job, API request charges, and manifest generation.
          </div>
          <table class="breakdown-table">
            <thead>
              <tr>
                <th style="width:42%">Cost Component</th>
                <th>Calculation</th>
                <th>Amount</th>
              </tr>
            </thead>
            <tbody id="body-s1"></tbody>
            <tfoot id="foot-s1">
              <tr><td colspan="2"><strong>TOTAL ESTIMATED COST</strong></td><td id="ftotal-s1">‚Äî</td></tr>
            </tfoot>
          </table>
        </div>

        <!-- PANEL S2 -->
        <div id="panel-s2" class="tab-panel">
          <div class="breakdown-desc">
            <strong>Scenario:</strong> Moving data between S3 buckets in <strong>different AWS accounts but the same region</strong>.
            Data transfer within the same AWS region is free even between different accounts. The batch job is run in the source account.
            Destination bucket must grant appropriate S3 bucket policy permissions to allow cross-account writes.
          </div>
          <table class="breakdown-table">
            <thead>
              <tr>
                <th style="width:42%">Cost Component</th>
                <th>Calculation</th>
                <th>Amount</th>
              </tr>
            </thead>
            <tbody id="body-s2"></tbody>
            <tfoot id="foot-s2">
              <tr><td colspan="2"><strong>TOTAL ESTIMATED COST</strong></td><td id="ftotal-s2">‚Äî</td></tr>
            </tfoot>
          </table>
        </div>

        <!-- PANEL S3 -->
        <div id="panel-s3" class="tab-panel">
          <div class="breakdown-desc">
            <strong>Scenario:</strong> Moving data between S3 buckets in <strong>different AWS accounts and different regions</strong>.
            Data transfer OUT from the source region applies and is the largest variable cost. The cross-region rate depends on the source/destination region pair shown in your inputs.
            Note: S3 Batch Operations must be initiated from the source region.
          </div>
          <table class="breakdown-table">
            <thead>
              <tr>
                <th style="width:42%">Cost Component</th>
                <th>Calculation</th>
                <th>Amount</th>
              </tr>
            </thead>
            <tbody id="body-s3"></tbody>
            <tfoot id="foot-s3">
              <tr><td colspan="2"><strong>TOTAL ESTIMATED COST</strong></td><td id="ftotal-s3">‚Äî</td></tr>
            </tfoot>
          </table>
        </div>

        <!-- COMPARE -->
        <div id="panel-compare" class="tab-panel">
          <div class="breakdown-desc">
            Side-by-side view of all three scenarios. Transfer costs make up the majority of cost difference for large data migrations.
          </div>
          <div class="compare-grid" id="compare-grid"></div>
        </div>
      </div>

    </div>
  </div>
</div>

<script>
// ===================== PRICING =====================
const P = {
  batchJobFee:      0.25,       // per job
  batchPerM:        1.00,       // per million objects
  putPer1k:         0.005,      // per 1,000 PUT/COPY requests
  getPer1k:         0.0004,     // per 1,000 GET requests
  listPer1k:        0.005,      // per 1,000 LIST requests
  inventoryPerM:    0.0025,     // per million objects listed
  kmsPer10k:        0.03,       // KMS API calls per 10,000 requests
};

// Data transfer OUT rates ($/GB) ‚Äî source region ‚Üí dest region
// Regions: N. Virginia, Ireland, London, Singapore, Hong Kong, Mumbai, Hyderabad, Jakarta
// Based on AWS published pricing (approximate). Same region = 0.
const TX = {
  //                                 ire     lon     sgp     hkg     bom     hyd     jak
  'us-east-1':      { 'eu-west-1':0.02, 'eu-west-2':0.02, 'ap-southeast-1':0.09, 'ap-east-1':0.09, 'ap-south-1':0.09, 'ap-south-2':0.09, 'ap-southeast-3':0.09 },
  'eu-west-1':      { 'us-east-1':0.02, 'eu-west-2':0.02, 'ap-southeast-1':0.09, 'ap-east-1':0.09, 'ap-south-1':0.09, 'ap-south-2':0.09, 'ap-southeast-3':0.09 },
  'eu-west-2':      { 'us-east-1':0.02, 'eu-west-1':0.02, 'ap-southeast-1':0.09, 'ap-east-1':0.09, 'ap-south-1':0.09, 'ap-south-2':0.09, 'ap-southeast-3':0.09 },
  'ap-southeast-1': { 'us-east-1':0.09, 'eu-west-1':0.09, 'eu-west-2':0.09,      'ap-east-1':0.09, 'ap-south-1':0.09, 'ap-south-2':0.09, 'ap-southeast-3':0.09 },
  'ap-east-1':      { 'us-east-1':0.08, 'eu-west-1':0.08, 'eu-west-2':0.08,      'ap-southeast-1':0.08, 'ap-south-1':0.08, 'ap-south-2':0.08, 'ap-southeast-3':0.08 },
  'ap-south-1':     { 'us-east-1':0.086,'eu-west-1':0.086,'eu-west-2':0.086,     'ap-southeast-1':0.086,'ap-east-1':0.086, 'ap-south-2':0.086,'ap-southeast-3':0.086 },
  'ap-south-2':     { 'us-east-1':0.086,'eu-west-1':0.086,'eu-west-2':0.086,     'ap-southeast-1':0.086,'ap-east-1':0.086, 'ap-south-1':0.086,'ap-southeast-3':0.086 },
  'ap-southeast-3': { 'us-east-1':0.09, 'eu-west-1':0.09, 'eu-west-2':0.09,      'ap-southeast-1':0.09, 'ap-east-1':0.09, 'ap-south-1':0.09, 'ap-south-2':0.09  },
};

function getRate(src, dst) {
  if (src === dst) return 0;
  return (TX[src] && TX[src][dst] !== undefined) ? TX[src][dst] : 0.02;
}

function fmtNum(n) {
  if (n >= 1e9) return (n/1e9).toFixed(2) + 'B';
  if (n >= 1e6) return (n/1e6).toFixed(2) + 'M';
  if (n >= 1e3) return (n/1e3).toFixed(1) + 'K';
  return n.toLocaleString();
}

function fmtBytes(gb) {
  if (gb >= 1024*1024) return (gb/1024/1024).toFixed(2) + ' PB';
  if (gb >= 1024) return (gb/1024).toFixed(2) + ' TB';
  return gb.toFixed(2) + ' GB';
}

function fmtDollar(v) {
  if (v === 0) return '<span class="cost-free">FREE</span>';
  if (v < 0.0001) return '<span class="cost-pos">$' + v.toExponential(2) + '</span>';
  if (v < 0.01) return '<span class="cost-pos">$' + v.toFixed(6) + '</span>';
  return '<span class="cost-pos">$' + v.toFixed(4) + '</span>';
}

function fmtTotal(v) {
  return '$' + v.toLocaleString('en-US', {minimumFractionDigits:2, maximumFractionDigits:2});
}

function renderRows(bodyId, footId, totalId, items) {
  const tbody = document.getElementById(bodyId);
  const tfoot = document.getElementById(footId);
  let total = 0;
  let rows = '';
  for (const item of items) {
    total += item.cost;
    rows += `<tr>
      <td>
        <div class="cost-name">${item.name}</div>
        <div class="cost-detail">${item.category}</div>
      </td>
      <td><div class="cost-detail" style="font-size:0.82rem;color:var(--text-muted)">${item.detail}</div></td>
      <td class="cost-amt">${fmtDollar(item.cost)}</td>
    </tr>`;
  }
  tbody.innerHTML = rows;
  document.getElementById(totalId).textContent = fmtTotal(total);
  return total;
}

function calculate() {
  const objects = Math.max(1, parseFloat(document.getElementById('numObjects').value) || 0);
  const gb      = Math.max(0, parseFloat(document.getElementById('totalGB').value) || 0);
  const jobs    = Math.max(1, parseFloat(document.getElementById('numJobs').value) || 1);
  const mMethod = document.getElementById('manifestMethod').value;
  const src     = document.getElementById('sourceRegion').value;
  const dst     = document.getElementById('destRegion').value;
  const rate    = getRate(src, dst);

  // Display helpers
  document.getElementById('objFormatHint').textContent = '= ' + objects.toLocaleString() + ' objects';
  document.getElementById('gbFormatHint').textContent = '= ' + fmtBytes(gb) + ' (~' + (gb/1024*0.9765625).toFixed(2) + ' TiB)';

  const avgMB = objects > 0 ? (gb * 1024) / objects : 0;
  document.getElementById('avgSizeDisplay').textContent = avgMB < 1
    ? (avgMB * 1024).toFixed(2) + ' KB per object'
    : avgMB.toFixed(2) + ' MB per object';

  // Transfer rate display
  document.getElementById('transferRateVal').textContent = src === dst
    ? 'FREE (same region)'
    : '$' + rate.toFixed(3) + '/GB';

  // ---- Manifest Cost ----
  let manifestCost = 0, manifestDetail = '', manifestHint = '', manifestLine = '';
  if (mMethod === 'list') {
    const listReqs = Math.ceil(objects / 1000);
    manifestCost = listReqs * (P.listPer1k / 1000);
    manifestDetail = `LIST API`;
    manifestHint = `${listReqs.toLocaleString()} LIST requests @ $${P.listPer1k}/1,000`;
    manifestLine = `Manifest cost: ${fmtTotal(manifestCost)} (${listReqs.toLocaleString()} requests)`;
    document.getElementById('manifestDetail').textContent =
      'ListObjectsV2 paginates 1,000 objects per API call. Requires ' + listReqs.toLocaleString() + ' requests for ' + fmtNum(objects) + ' objects.';
  } else if (mMethod === 'inventory') {
    manifestCost = (objects / 1e6) * P.inventoryPerM;
    manifestDetail = `S3 Inventory`;
    manifestHint = `${(objects/1e6).toFixed(3)}M objects √ó $${P.inventoryPerM}/million`;
    manifestLine = `Manifest cost: ${fmtTotal(manifestCost)} (inventory report)`;
    document.getElementById('manifestDetail').textContent =
      'S3 Inventory generates daily or weekly CSV/ORC/Parquet reports. Output is stored in a specified S3 bucket and can be used directly as a Batch Operations manifest.';
  } else {
    manifestCost = 0;
    manifestDetail = `Pre-existing`;
    manifestHint = `No cost ‚Äî manifest already available`;
    manifestLine = `No manifest generation cost`;
    document.getElementById('manifestDetail').textContent =
      'Using a pre-existing manifest file (e.g., from a previous inventory or custom list). No manifest generation costs apply.';
  }
  document.getElementById('manifestCostLine').textContent = manifestLine;

  // ---- Batch Ops ----
  const batchJob  = jobs * P.batchJobFee;
  const batchObj  = (objects / 1e6) * P.batchPerM;

  // ---- Requests ----
  const getCost   = objects * (P.getPer1k / 1000);   // GET from source (1 per object)
  const putCost   = objects * (P.putPer1k / 1000);   // PUT/COPY to dest (1 per object)

  // ---- Transfer ----
  const xferCost  = gb * rate;

  // ---- KMS ----
  const kmsType = document.getElementById('kmsType').value;
  const kmsCallsPerObj = kmsType !== 'sse-s3' ? 2 : 0; // 1 Decrypt (source read) + 1 GenerateDataKey (dest write)
  const kmsCallCost    = P.kmsPer10k / 10000;
  const kmsCost        = objects * kmsCallsPerObj * kmsCallCost;

  // KMS info text
  const kmsWarningEl = document.getElementById('kmsWarning');
  if (kmsType === 'sse-s3') {
    document.getElementById('kmsInfo').textContent =
      'SSE-S3 uses S3-managed AES-256 keys. No KMS API calls are made ‚Äî encryption is handled entirely by S3 at no extra charge.';
    document.getElementById('kmsCostLine').textContent = 'No KMS cost';
    kmsWarningEl.style.display = 'none';
  } else if (kmsType === 'aws') {
    document.getElementById('kmsInfo').textContent =
      'AWS managed keys (aws/s3) are free to store but KMS API calls are still charged. ' +
      'Each object copy triggers 1 Decrypt call on the source and 1 GenerateDataKey call on the destination.';
    document.getElementById('kmsCostLine').textContent =
      `KMS cost: $${kmsCost.toFixed(4)} (${fmtNum(objects)} objects √ó 2 calls √ó $${P.kmsPer10k}/10,000)`;
    kmsWarningEl.innerHTML =
      '‚ö†Ô∏è <strong>Cross-account restriction:</strong> AWS managed keys (aws/s3) cannot be shared across accounts. ' +
      'For cross-account scenarios, both buckets must use Customer Managed Keys (CMK) with cross-account key policies.';
    kmsWarningEl.style.display = 'block';
  } else {
    document.getElementById('kmsInfo').textContent =
      'Each object copy makes 2 KMS API calls: one Decrypt on the source (to read the data key) and one GenerateDataKey on the destination (to encrypt the copy). ' +
      'CMK key storage costs $1.00/month per key ‚Äî not included here as it is an ongoing cost.';
    document.getElementById('kmsCostLine').textContent =
      `KMS cost: $${kmsCost.toFixed(4)} (${fmtNum(objects)} objects √ó 2 calls √ó $${P.kmsPer10k}/10,000)`;
    kmsWarningEl.innerHTML =
      '‚ö†Ô∏è <strong>Cross-account:</strong> The source CMK key policy must grant the batch job IAM role permission to call <code>kms:Decrypt</code>. ' +
      'The destination CMK must allow <code>kms:GenerateDataKey</code> to the writing principal.<br>' +
      '‚ö†Ô∏è <strong>Cross-region:</strong> CMKs are region-scoped. You need a separate CMK (or a multi-region key) in the destination region.';
    kmsWarningEl.style.display = 'block';
  }

  const kmsLabel = kmsType === 'sse-s3' ? 'SSE-S3 ‚Äî No KMS Charge'
    : kmsType === 'aws' ? 'AWS Managed Key (aws/s3)'
    : 'Customer Managed Key (CMK)';
  const kmsDetail = kmsType === 'sse-s3'
    ? 'S3-managed encryption ‚Äî no KMS API calls'
    : `${fmtNum(objects)} objects √ó 2 KMS calls (Decrypt + GenerateDataKey) √ó $${P.kmsPer10k}/10,000`;

  // ======================== SCENARIO ITEMS ========================

  const commonItems = [
    {
      name: 'Manifest Generation',
      category: manifestDetail,
      detail: manifestHint,
      cost: manifestCost
    },
    {
      name: 'S3 Batch Operations ‚Äî Job Fee',
      category: 'Batch Operations',
      detail: `${jobs} job${jobs>1?'s':''} √ó $${P.batchJobFee}/job`,
      cost: batchJob
    },
    {
      name: 'S3 Batch Operations ‚Äî Per Object',
      category: 'Batch Operations',
      detail: `${(objects/1e6).toFixed(3)}M objects √ó $${P.batchPerM}/million`,
      cost: batchObj
    },
    {
      name: 'GET Requests (Source Bucket)',
      category: 'S3 API Requests',
      detail: `${fmtNum(objects)} objects √ó $${P.getPer1k}/1,000 requests`,
      cost: getCost
    },
    {
      name: 'PUT / COPY Requests (Dest Bucket)',
      category: 'S3 API Requests',
      detail: `${fmtNum(objects)} objects √ó $${P.putPer1k}/1,000 requests`,
      cost: putCost
    },
    {
      name: 'KMS API Calls',
      category: kmsLabel,
      detail: kmsDetail,
      cost: kmsCost
    },
  ];

  const s1Items = [...commonItems, {
    name: 'Data Transfer',
    category: 'Same Region ‚Äî No Charge',
    detail: 'Data movement within the same region is always free',
    cost: 0
  }];

  const s2Items = [...commonItems, {
    name: 'Data Transfer',
    category: 'Same Region ‚Äî No Charge (Cross-Account)',
    detail: 'Same-region data transfer is free even between different AWS accounts',
    cost: 0
  }];

  const s3Items = [...commonItems, {
    name: 'Data Transfer OUT (Cross-Region)',
    category: `${src} ‚Üí ${dst}`,
    detail: `${fmtBytes(gb)} √ó $${rate.toFixed(4)}/GB ‚Äî charged at source region data transfer OUT rate`,
    cost: xferCost
  }];

  const t1 = renderRows('body-s1', 'foot-s1', 'ftotal-s1', s1Items);
  const t2 = renderRows('body-s2', 'foot-s2', 'ftotal-s2', s2Items);
  const t3 = renderRows('body-s3', 'foot-s3', 'ftotal-s3', s3Items);

  document.getElementById('total-s1').textContent = fmtTotal(t1);
  document.getElementById('total-s2').textContent = fmtTotal(t2);
  document.getElementById('total-s3').textContent = fmtTotal(t3);

  const minTotal = Math.min(t1, t2, t3);
  const perGBs = [t1,t2,t3].map(t => gb > 0 ? t/gb : 0);
  const perObjS = [t1,t2,t3].map(t => objects > 0 ? (t/objects*1000).toFixed(4) : 0);

  document.getElementById('note-s1').innerHTML = (t1 === minTotal ? '<span class="cheapest-badge">Cheapest</span> ' : '') + '$' + (gb > 0 ? (t1/gb).toFixed(4) : '‚Äî') + '/GB ¬∑ $' + perObjS[0] + '/K objects';
  document.getElementById('note-s2').innerHTML = (t2 === minTotal ? '<span class="cheapest-badge">Cheapest</span> ' : '') + '$' + (gb > 0 ? (t2/gb).toFixed(4) : '‚Äî') + '/GB ¬∑ $' + perObjS[1] + '/K objects';
  document.getElementById('note-s3').innerHTML = (t3 === minTotal ? '<span class="cheapest-badge">Cheapest</span> ' : '') + '$' + (gb > 0 ? (t3/gb).toFixed(4) : '‚Äî') + '/GB ¬∑ $' + perObjS[2] + '/K objects';

  // Comparison view
  renderCompare(s1Items, s2Items, s3Items, t1, t2, t3);
}

function renderCompare(s1, s2, s3, t1, t2, t3) {
  const cols = [
    { label: 'Same Acct ¬∑ Same Region', cls: 's1h', tcls: 's1-total', items: s1, total: t1 },
    { label: 'Cross Acct ¬∑ Same Region', cls: 's2h', tcls: 's2-total', items: s2, total: t2 },
    { label: 'Cross Acct ¬∑ Cross Region', cls: 's3h', tcls: 's3-total', items: s3, total: t3 },
  ];

  const html = cols.map(col => {
    const rows = col.items.map(item => `
      <div class="compare-item">
        <span class="compare-item-label">${item.name}</span>
        <span class="compare-item-val">${item.cost === 0 ? '<span class="cost-free">FREE</span>' : '$' + item.cost.toFixed(4)}</span>
      </div>`).join('');
    return `<div class="compare-col">
      <div class="compare-col-header ${col.cls}">${col.label}</div>
      ${rows}
      <div class="compare-total">
        <span>Total</span>
        <span class="${col.tcls}">${fmtTotal(col.total)}</span>
      </div>
    </div>`;
  }).join('');

  document.getElementById('compare-grid').innerHTML = html;
}

function switchTab(id, btn) {
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('panel-' + id).classList.add('active');
}

// Auto-recalculate on any change
document.querySelectorAll('input, select').forEach(el => {
  el.addEventListener('input', calculate);
  el.addEventListener('change', calculate);
});

// Initial render
calculate();
</script>
</body>
</html>
